<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Estado Financiero Consolidado</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg-start:#eef4ff;
    --bg-end:#f6f8fa;
    --card:#ffffff;
    --muted:#6b7280;
    --text:#0f1724;
    --accent:#315bff;
    --accent-2:#2d8fff;
    --bad:#ff5b5b;
    --glass: rgba(255,255,255,0.6);
    --radius:14px;
    --soft-shadow: 10px 14px 30px rgba(28,44,80,0.06);
    --inset-shadow: inset 4px 4px 10px rgba(163,177,198,0.06), inset -3px -3px 8px rgba(255,255,255,0.8);
    --gap:12px;
    --container:1100px;
    --thumb:64px;
    --btn-h:40px;
  }

  /* reset y base */
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family:'Inter', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background: linear-gradient(180deg,var(--bg-start),var(--bg-end));
    color:var(--text);
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    padding:18px;
  }

  .wrap{ max-width:var(--container); margin:0 auto; padding:8px; }

  /* header */
  header{
    background: linear-gradient(135deg,var(--accent),var(--accent-2));
    color:#fff;
    padding:18px;
    border-radius:12px;
    margin-bottom:16px;
    box-shadow: 8px 12px 34px rgba(45,88,255,0.12);
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
  }
  header h1{ font-size:1.1rem; margin:0; letter-spacing:-0.2px; font-weight:700; }
  header .subtitle{ color:rgba(255,255,255,0.9); font-size:0.92rem; opacity:0.95; }
  header .brand-left{ display:flex; align-items:center; gap:12px; }
  .logo{
    width:56px; height:56px; border-radius:10px; display:grid; place-items:center;
    background:linear-gradient(135deg,#ffffff22,rgba(255,255,255,0.06));
    border: 1px solid rgba(255,255,255,0.08);
    font-weight:800; color:white;
    box-shadow: 6px 8px 18px rgba(10,20,40,0.06), inset -2px -2px 6px rgba(255,255,255,0.04);
  }

  /* grid y cards */
  .grid{ display:grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap:var(--gap); }
  .card{
    background: linear-gradient(180deg,var(--card), #fbfeff);
    padding:14px;
    border-radius:12px;
    box-shadow: var(--soft-shadow);
    border:1px solid rgba(16,24,40,0.02);
    display:flex; flex-direction:column; gap:8px;
    min-height:110px;
    transition: transform .12s ease, box-shadow .12s ease;
  }
  .card:hover{ transform: translateY(-4px); box-shadow: 18px 24px 48px rgba(10,20,40,0.06); }
  .card.neg{ border-left:4px solid var(--bad); }
  .card:not(.neg){ border-left:4px solid rgba(49,91,255,0.12); }

  h3{ font-size:0.95rem; margin:0; color:#10233a; font-weight:700; }
  .val{ font-weight:800; font-size:1.35rem; margin-top:6px; color:var(--text); }
  .muted{ color:var(--muted); font-size:0.9rem; }

  /* lists */
  .list{ background: linear-gradient(180deg,var(--card),#fbfeff); padding:12px; border-radius:12px; margin-top:12px; box-shadow:6px 8px 18px rgba(10,20,40,0.03); border:1px solid rgba(16,24,40,0.02); }
  .item{ display:flex; justify-content:space-between; align-items:center; padding:10px 8px; border-bottom:1px dashed rgba(16,24,40,0.04); gap:8px; }
  .item:last-child{ border-bottom:none; }
  .negv{ color:var(--bad); font-weight:700; }

  /* loading */
  #loading{ display:flex; flex-direction:column; align-items:center; padding:30px; color:var(--muted); background:linear-gradient(180deg,#ffffffaa,#ffffff88); border-radius:12px; border:1px solid rgba(16,24,40,0.02); box-shadow: 8px 10px 20px rgba(10,20,40,0.03); }
  .spinner{ width:40px; height:40px; border:4px solid #eef2ff; border-top-color:var(--accent); border-radius:999px; animation:spin 1s linear infinite; margin-top:12px; }
  @keyframes spin{ to{ transform:rotate(360deg); } }

  /* details */
  details.info{ margin-top:8px; }
  details.info summary{ cursor:pointer; font-size:0.9rem; color:var(--accent); font-weight:600; list-style:none; }
  details.info[open] summary{ color:var(--accent-2); }
  .info-body{ margin-top:8px; font-size:0.9rem; color:#334155; line-height:1.3; }
  .info-body b{ display:inline-block; width:110px; color:#0f1724; font-weight:600; }

  /* small utilities */
  .muted-small{ color:var(--muted); font-size:0.85rem; }
  .right{ text-align:right; }
  .center{ text-align:center; }

  /* responsive tweaks */
  @media (max-width:720px){
    header{ flex-direction:column; align-items:flex-start; gap:8px; padding:12px; }
    .logo{ width:48px; height:48px; }
    .val{ font-size:1.05rem; }
    .grid{ gap:10px; }
    .wrap{ padding:10px; }
  }

  /* accesibilidad */
  :focus{ outline: none; }
  :focus-visible { outline: 3px solid rgba(49,91,255,0.14); outline-offset:3px; border-radius:8px; }
  @media (prefers-reduced-motion: reduce){
    *{ animation-duration:0.001ms !important; animation-iteration-count:1 !important; transition-duration:0.001ms !important; }
  }

  /* prevent accidental horizontal scroll */
  html,body{ overflow-x:hidden; }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="brand-left">
      <div class="logo">EF</div>
      <div>
        <h1>Estado Financiero Consolidado</h1>
        <div class="subtitle muted-small">Indicadores clave con terminología empresarial estándar</div>
      </div>
      <button onclick="fetchData()" class="btn primary">Actualizar</button>
    </div>
  </header>

  <div id="loading">
    <div style="font-weight:600">Calculando indicadores financieros...</div>
    <div class="spinner" aria-hidden="true"></div>
  </div>

  <div id="content" style="display:none">
    <div class="grid" id="stats-grid">
      <div class="card" id="inventory-card">
        <h3>Valoración de Inventario</h3>
        <div class="val" id="stat-inventory">$0.00</div>
        <div class="muted">Activos corrientes en almacén</div>
        <details class="info">
          <summary>Detalles</summary>
          <div class="info-body">
            <div><b>Concepto:</b> Valor monetario total del inventario disponible.</div>
            <div><b>Metodología:</b> Suma del valor de todos los productos en existencias según coste de adquisición.</div>
            <div><b>Aplicación:</b> Evaluación de capital circulante y gestión de activos corrientes.</div>
          </div>
        </details>
      </div>

      <div class="card" id="purchases-card">
        <h3>Compras Totales</h3>
        <div class="val" id="stat-purchases">$0.00</div>
        <div class="muted">Adquisición de mercancías</div>
        <details class="info"><summary>Detalles</summary>
          <div class="info-body">
            <div><b>Concepto:</b> Inversión total en aprovisionamientos.</div>
            <div><b>Metodología:</b> Consolidación del importe de todas las órdenes de compra.</div>
            <div><b>Aplicación:</b> Control de flujo de caja y análisis de inversión en inventarios.</div>
          </div>
        </details>
      </div>

      <div class="card" id="restock-card">
        <h3>Requerimiento de Reposición</h3>
        <div class="val" id="stat-restock">$0.00</div>
        <div class="muted">Para niveles óptimos de stock</div>
        <details class="info"><summary>Detalles</summary>
          <div class="info-body">
            <div><b>Concepto:</b> Inversión necesaria para alcanzar inventario objetivo.</div>
            <div><b>Metodología:</b> (Stock recomendado - Existencias actuales) * Coste unitario.</div>
            <div><b>Aplicación:</b> Presupuesto de compras y planificación de capital de trabajo.</div>
          </div>
        </details>
      </div>

      <div class="card" id="recovery-card">
        <h3>Recuperación de Inversión</h3>
        <div class="val" id="stat-recovery">$0.00</div>
        <div class="muted">Resultado neto - Requerimiento</div>
        <details class="info"><summary>Detalles</summary>
          <div class="info-body">
            <div><b>Concepto:</b> Capacidad de autofinanciación para reposición de inventarios.</div>
            <div><b>Metodología:</b> Resultado neto del período - Requerimiento de reposición.</div>
            <div><b>Aplicación:</b> Evaluación de liquidez operativa y sostenibilidad financiera.</div>
          </div>
        </details>
      </div>
    </div>

    <div class="grid" style="margin-top:12px">
      <div class="card">
        <h3>Ventas Brutas</h3>
        <div class="val" id="total-ventas">$0.00</div>
        <div class="muted">Ingresos antes de descuentos</div>
        <details class="info"><summary>Detalles</summary>
          <div class="info-body">
            <div><b>Concepto:</b> Volumen total de ingresos por ventas.</div>
            <div><b>Metodología:</b> Sumatoria del valor de todas las transacciones comerciales.</div>
            <div><b>Aplicación:</b> Medición de volumen de negocio y tendencias comerciales.</div>
          </div>
        </details>
      </div>

      <div class="card">
        <h3>Ventas Netas</h3>
        <div class="val" id="total-ventas-neto">$0.00</div>
        <div class="muted">Ingresos después de descuentos</div>
        <details class="info"><summary>Detalles</summary>
          <div class="info-body">
            <div><b>Concepto:</b> Ingresos efectivos por actividades comerciales.</div>
            <div><b>Metodología:</b> Ventas brutas - Descuentos comerciales.</div>
            <div><b>Aplicación:</b> Cálculo de rentabilidad y margen comercial.</div>
          </div>
        </details>
      </div>

      <div class="card">
        <h3>Otros Ingresos</h3>
        <div class="val" id="total-otros-ingresos">$0.00</div>
        <div class="muted">Ingresos no operacionales</div>
        <details class="info"><summary>Detalles</summary>
          <div class="info-body">
            <div><b>Concepto:</b> Ingresos extraordinarios o no comerciales.</div>
            <div><b>Metodología:</b> Consolidación de todos los ingresos no vinculados a ventas.</div>
            <div><b>Aplicación:</b> Análisis de fuentes alternativas de ingresos.</div>
          </div>
        </details>
      </div>

      <div class="card" id="neto-card">
        <h3>Resultado Neto</h3>
        <div class="val" id="total-neto">$0.00</div>
        <div class="muted">Beneficio o Pérdida del período</div>
        <details class="info"><summary>Detalles</summary>
          <div class="info-body">
            <div><b>Concepto:</b> Resultado económico final del ejercicio.</div>
            <div><b>Metodología:</b> Ventas netas + Otros ingresos - Gastos operativos - Compras.</div>
            <div><b>Aplicación:</b> Evaluación de rentabilidad y desempeño financiero.</div>
          </div>
        </details>
      </div>
    </div>

    <div class="list" style="margin-top:12px">
      <strong>Análisis por Cliente</strong>
      <div id="resumen-clientes" style="margin-top:8px"></div>
    </div>

    <div class="list" style="margin-top:12px">
      <strong>Desempeño por Vendedor</strong>
      <div id="resumen-vendedores" style="margin-top:8px"></div>
    </div>

    <div class="list" style="margin-top:12px">
      <strong>Impacto de Descuentos</strong>
      <div id="resumen-descuentos" style="margin-top:8px"></div>
    </div>
  </div>
</div>

<script>
/* FACTORES y URL */
const FACTORES = { mg:0.001, g:1, kg:1000, ml:1, l:1000, pz:1 };
const API_URL = 'https://script.google.com/macros/s/AKfycbxBOyRG_Q3hEtHyRcgnhYLqk4yB5BGWQXQC4cDb-QG45Gs96fL5dnn9B9GD87rS9ghW7w/exec';

/* UI helpers */
const showLoading = s => { 
  document.getElementById('loading').style.display = s ? 'flex' : 'none'; 
  document.getElementById('content').style.display = s ? 'none' : 'block'; 
};

const fmt = v => { 
  const n = Number(v||0); 
  return (n<0?'-':'') + '$' + new Intl.NumberFormat('es-ES',{
    minimumFractionDigits:2,
    maximumFractionDigits:2
  }).format(Math.abs(n)); 
};

/* fetch helper */
const callApi = params => { 
  const url = new URL(API_URL); 
  Object.entries(params||{}).forEach(([k,v]) => url.searchParams.append(k,v)); 
  return fetch(url).then(r=>r.json()).catch(()=>({status:'error'})); 
};

/* Obtener datos */
const fetchData = async () => { 
  showLoading(true); 
  try { 
    const [alm, comp, vent, bal, coc] = await Promise.all([
      callApi({op:'obtenerAlmacen'}),
      callApi({op:'obtenerCompras'}),
      callApi({op:'obtenerVentas'}),
      callApi({op:'obtenerBalances'}),
      callApi({op:'obtenerCocina'})
    ]); 
    
    return {
      almacen: alm.status==='success'?alm.data||[]:[],
      compras: comp.status==='success'?comp.data||[]:[],
      ventas: vent.status==='success'?vent.data||[]:[],
      balances: bal.status==='success'?bal.data||[]:[],
      cocina: coc.status==='success'? (coc.data||[]).map(r=>({
        ...r, 
        ingredientes: typeof r.ingredientes === 'string'? 
          JSON.parse(r.ingredientes) : (r.ingredientes||[])
      })) : [] 
    };
  } catch(e){ 
    console.error(e); 
    return {almacen:[],compras:[],ventas:[],balances:[],cocina:[]}; 
  } finally { 
    showLoading(false); 
  } 
};

/* Construir información de productos */
const buildProductInfo = almacen => {
  return (almacen||[]).reduce((acc, p) => {
    const uni = (p.unidadDeMedida||'').toLowerCase().trim();
    const qtyBase = (Number(p.cantidad)||0) * (FACTORES[uni]||1);
    const priceBase = qtyBase > 0 ? (Number(p.precio)||0) / qtyBase : 0;
    
    acc[String(p.codigo)] = {
      name: p.nombre||'Producto sin nombre',
      priceBase,
      stockRecomendado: Number(p.stockRecomendado)||0,
      unidad: p.unidadDeMedida||'pz'
    };
    
    return acc;
  }, {});
};

/* Mapear compras y uso */
const computeMaps = (compras, ventas, cocina) => {
  const compMap = {}, usedMap = {};
  
  // Procesar compras
  (compras||[]).forEach(c => {
    const id = String(c.idProducto);
    const cantidad = Number(c.cantidad)||0;
    const factor = FACTORES[((c.unidad||c.unidadDeMedida)||'').toLowerCase().trim()] || 1;
    compMap[id] = (compMap[id]||0) + cantidad * factor;
  });
  
  // Procesar ventas
  (ventas||[]).forEach(v => {
    const items = Array.isArray(v.venta) ? v.venta : [];
    items.forEach(it => {
      const code = String(it.codigo ?? it.producto ?? it.id);
      const qty = Number(it.cantidad)||0;
      const receta = (cocina||[]).find(r => String(r.codigo) === code);
      
      if(receta && Array.isArray(receta.ingredientes)){
        receta.ingredientes.forEach(ing => {
          const ingCode = String(ing.codigo);
          const ingQty = Number(ing.cantidad)||0;
          const ingFactor = FACTORES[((ing.unidad||ing.unidadDeMedida)||'').toLowerCase().trim()] || 1;
          usedMap[ingCode] = (usedMap[ingCode]||0) + ingQty * ingFactor * qty;
        });
      } else {
        const factor = FACTORES[((it.unidad||it.unidadDeMedida)||'').toLowerCase().trim()] || 1;
        usedMap[code] = (usedMap[code]||0) + qty * factor;
      }
    });
  });
  
  return { compMap, usedMap };
};

/* Procesar datos de ventas */
const processSalesData = ventas => {
  const clientes = {}, vendedores = {}, descuentos = {};
  let totalVentas = 0, totalDescuentos = 0;
  
  (ventas||[]).forEach(venta => {
    const items = Array.isArray(venta.venta) ? venta.venta : [];
    const ventaTotal = items.reduce((s, it) => s + (Number(it.total)||0), 0);
    totalVentas += ventaTotal;
    
    const meta = Array.isArray(venta.codigosdeventa) ? 
      (venta.codigosdeventa[0]||{}) : 
      (venta.codigosdeventa||{});
    
    const cliente = meta?.cliente || 'Sin Cliente';
    const vendedor = meta?.empleado || 'Sin Vendedor';
    const descuentoPct = Number(meta?.descuento)||0;
    const montoDescuento = ventaTotal * (descuentoPct/100);
    totalDescuentos += montoDescuento;
    const totalFinal = ventaTotal - montoDescuento;
    
    // Actualizar datos de clientes
    clientes[cliente] = clientes[cliente] || {compras:0, ventas:0, descuentos:0, total:0};
    clientes[cliente].compras++;
    clientes[cliente].ventas += ventaTotal;
    clientes[cliente].descuentos += montoDescuento;
    clientes[cliente].total += totalFinal;
    
    // Actualizar datos de vendedores
    vendedores[vendedor] = vendedores[vendedor] || {transacciones:0, ventas:0, descuentos:0, total:0};
    vendedores[vendedor].transacciones++;
    vendedores[vendedor].ventas += ventaTotal;
    vendedores[vendedor].descuentos += montoDescuento;
    vendedores[vendedor].total += totalFinal;
    
    // Actualizar descuentos
    if(descuentoPct > 0){
      const key = `${descuentoPct}%`;
      descuentos[key] = (descuentos[key]||0) + montoDescuento;
    }
  });
  
  return { clientes, vendedores, descuentos, totalVentas, totalDescuentos };
};

/* Calcular y renderizar */
const calculateAndRender = allData => {
  const { almacen, compras, ventas, balances, cocina } = allData;
  const productInfo = buildProductInfo(almacen);
  const { compMap, usedMap } = computeMaps(compras, ventas, cocina);
  
  let inventoryValue = 0, restockValue = 0, totalComprasValor = 0;
  const deficitItems = [];
  
  // Calcular valor total de compras
  compras.forEach(c => totalComprasValor += Number(c.precio)||0);
  
  // Calcular valor de inventario y requerimiento de reposición
  (almacen||[]).forEach(prod => {
    const codigo = String(prod.codigo);
    const info = productInfo[codigo] || {};
    const unidad = (prod.unidadDeMedida||'').toLowerCase().trim();
    const unidadFactor = FACTORES[unidad]||1;
    const recBase = (Number(prod.stockRecomendado)||0) * unidadFactor;
    const bought = compMap[codigo] || 0;
    const used = usedMap[codigo] || 0;
    const remain = bought - used;
    
    let priceBase = Number(info.priceBase||0);
    if(!priceBase){
      const qtyBase = (Number(prod.cantidad)||0) * unidadFactor;
      priceBase = qtyBase > 0 ? (Number(prod.precio)||0) / qtyBase : 0;
    }
    
    const itemValue = remain * priceBase;
    inventoryValue += itemValue;
    
    const delta = recBase - remain;
    if(delta > 0) restockValue += delta * priceBase;
    
    if(remain < 0) {
      deficitItems.push({ 
        name: prod.nombre || `Producto ${codigo}`, 
        deficit: Math.abs(remain) / unidadFactor, 
        unit: prod.unidadDeMedida || 'pz', 
        value: Math.abs(itemValue) 
      });
    }
  });
  
  // Procesar datos de ventas
  const salesSummary = processSalesData(ventas);
  const ventasBruto = salesSummary.totalVentas;
  const ventasNetas = ventasBruto - salesSummary.totalDescuentos;
  
  // Calcular otros ingresos y gastos
  const otherIncome = (balances||[]).filter(b => 
    String(b.tipo) === 'ingreso' && 
    (b.estado === 'activo' || b.estado === true || b.estado === '1')
  ).reduce((s, b) => s + (Number(b.monto)||0), 0);
  
  const otherExpenses = (balances||[]).filter(b => 
    String(b.tipo) === 'deducible' && 
    (b.estado === 'activo' || b.estado === true || b.estado === '1')
  ).reduce((s, b) => s + (Number(b.monto)||0), 0);
  
  // Calcular resultado neto y recuperación de inversión
  const totalNeto = ventasNetas + otherIncome - otherExpenses - totalComprasValor;
  const recoveryInvestment = totalNeto - restockValue;
  
  // Actualizar UI
  updateUI({
    inventoryValue,
    totalComprasValor,
    restockValue,
    recoveryInvestment,
    ventasBruto,
    ventasNetas,
    otherIncome,
    otherExpenses,
    totalNeto,
    salesSummary,
    deficitItems
  });
};

/* Actualizar UI */
const updateUI = data => {
  const {
    inventoryValue,
    totalComprasValor,
    restockValue,
    recoveryInvestment,
    ventasBruto,
    ventasNetas,
    otherIncome,
    otherExpenses,
    totalNeto,
    salesSummary
  } = data;
  
  // Función auxiliar para formatear valores
  const set = (id, v, cardId) => {
    const el = document.getElementById(id);
    if(el) el.textContent = fmt(v);
    if(cardId) {
      const card = document.getElementById(cardId);
      if(card) {
        v < 0 ? card.classList.add('neg') : card.classList.remove('neg');
      }
    }
  };
  
  // Actualizar tarjetas principales
  set('stat-inventory', inventoryValue, 'inventory-card');
  set('stat-purchases', totalComprasValor, 'purchases-card');
  set('stat-restock', restockValue, 'restock-card');
  set('stat-recovery', recoveryInvestment, 'recovery-card');
  set('total-ventas', ventasBruto);
  set('total-ventas-neto', ventasNetas);
  set('total-otros-ingresos', otherIncome);
  set('total-neto', totalNeto, 'neto-card');
  
  // Generar resúmenes
  generateResumenes(salesSummary);
};

/* Generar resúmenes */
const generateResumenes = ({clientes, vendedores, descuentos}) => {
  const renderCollection = (obj, containerId, label) => {
    const c = document.getElementById(containerId);
    if(!c) return;
    
    c.innerHTML = '';
    if(!obj || Object.keys(obj).length === 0) {
      c.innerHTML = '<div class="item">No hay datos disponibles</div>';
      return;
    }
    
    Object.entries(obj).forEach(([k, d]) => {
      const el = document.createElement('div');
      el.className = 'item';
      
      if(label === 'Cliente') {
        el.innerHTML = `
          <div>
            <div><strong>${k}</strong></div>
            <div style="font-size:0.9rem;color:var(--muted)">Compras: ${d.compras||0}</div>
          </div>
          <div style="text-align:right">
            <div>Monto: ${fmt(d.ventas||0)}</div>
            <div>Descuentos: ${fmt(-(d.descuentos||0))}</div>
            <div><strong>Total: ${fmt(d.total||0)}</strong></div>
          </div>
        `;
      } else {
        el.innerHTML = `
          <div>
            <div><strong>${k}</strong></div>
            <div style="font-size:0.9rem;color:var(--muted)">Transacciones: ${d.transacciones||0}</div>
          </div>
          <div style="text-align:right">
            <div>Monto: ${fmt(d.ventas||0)}</div>
            <div>Descuentos: ${fmt(-(d.descuentos||0))}</div>
            <div><strong>Total: ${fmt(d.total||0)}</strong></div>
          </div>
        `;
      }
      
      c.appendChild(el);
    });
  };
  
  // Renderizar clientes y vendedores
  renderCollection(clientes, 'resumen-clientes', 'Cliente');
  renderCollection(vendedores, 'resumen-vendedores', 'Vendedor');
  
  // Renderizar descuentos
  const cd = document.getElementById('resumen-descuentos');
  if(cd) {
    cd.innerHTML = '';
    if(!descuentos || Object.keys(descuentos).length === 0) {
      cd.innerHTML = '<div class="item">No se aplicaron descuentos</div>';
      return;
    }
    
    Object.entries(descuentos).forEach(([pct, monto]) => {
      const el = document.createElement('div');
      el.className = 'item';
      el.innerHTML = `<div>Descuento ${pct}</div><div style="text-align:right">${fmt(-monto)}</div>`;
      cd.appendChild(el);
    });
    
    const totalDescuentos = Object.values(descuentos).reduce((s, v) => s + v, 0);
    const totalEl = document.createElement('div');
    totalEl.className = 'item';
    totalEl.innerHTML = `
      <div><strong>Total descuentos</strong></div>
      <div style="text-align:right">${fmt(-totalDescuentos)}</div>
    `;
    cd.appendChild(totalEl);
  }
};

/* Inicializar */
const init = async () => { 
  showLoading(true); 
  const data = await fetchData(); 
  calculateAndRender(data); 
  showLoading(false); 
};

document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
