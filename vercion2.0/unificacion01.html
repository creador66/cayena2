async function registrarVenta(items, cuentaName, full) {
  // Crear overlay/modal
  const overlay = document.createElement('div');
  overlay.style = `
    position: fixed; inset: 0;
    background: rgba(0,0,0,0.4);
    display: flex; align-items: center; justify-content: center;
    z-index: 10000;
  `;
  // Construir contenido del modal
  const modal = document.createElement('div');
  modal.style = `
    background: #fff; border-radius: 8px;
    padding: 1.5rem; width: 90%; max-width: 400px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
  `;
  // Lista de items
  const itemsList = items.map(i => {
    const subtotal = (i.precio * i.qty).toFixed(2);
    return `<li>${i.nombre} x${i.qty} — $${subtotal}</li>`;
  }).join('');
  // Total
  const total = items
    .reduce((sum, i) => sum + i.precio * i.qty, 0)
    .toFixed(2);
  
  modal.innerHTML = `
    <h3 style="margin-top:0;">Cobrar ${full ? 'Mesa' : 'Subcuenta'}</h3>
    <ul style="max-height:200px; overflow-y:auto; margin:0 0 1rem; padding-left:1.2rem;">
      ${itemsList}
    </ul>
    <p style="font-weight:600; text-align:right; margin:0 0 1rem;">
      Total: $${total}
    </p>
    <label for="pay-method" style="display:block; margin-bottom:0.5rem;">Método de pago:</label>
    <select id="pay-method" style="width:100%; padding:0.6rem; margin-bottom:1.2rem; border-radius:4px; border:1px solid #ccc;">
      <option>Efectivo</option>
      <option>Tarjeta</option>
      <option>Transferencia</option>
    </select>
    <div style="text-align:right;">
      <button id="cancel-sale" style="margin-right:0.5rem; padding:0.6rem 1.2rem; background:#ccc; border:none; border-radius:4px;">Cancelar</button>
      <button id="confirm-sale" style="padding:0.6rem 1.2rem; background:#28a745; color:#fff; border:none; border-radius:4px;">Confirmar</button>
    </div>
  `;
  overlay.appendChild(modal);
  document.body.appendChild(overlay);

  // Controladores
  overlay.querySelector('#cancel-sale').onclick = () => {
    document.body.removeChild(overlay);
  };
  overlay.querySelector('#confirm-sale').onclick = async () => {
    const metodo = overlay.querySelector('#pay-method').value;
    const venta = {
      fecha: new Date().toISOString(),
      metodoPago: metodo,
      items: items.map(i => ({
        codigo: String(i.codigo),
        cuenta: cuentaName,
        producto: i.nombre,
        cantidad: i.qty,
        total: +(i.precio * i.qty).toFixed(2)
      }))
    };
    try {
      await apiFetch('guardarVentas', {
        venta: JSON.stringify(venta),
        metodoPago: metodo
      });
      alert(`Cobro registrado exitosamente con ${metodo}`);
      document.body.removeChild(overlay);
    } catch (err) {
      alert('Error al guardar la venta: ' + err.message);
    }
  };
}
